<script>
    import '@fontsource-variable/geist-mono'
    import Clock from './lib/components/Clock.svelte'
    import Links from './lib/components/Links.svelte'
    import NotePage from './lib/components/NotePage.svelte'
    import Settings from './lib/components/Settings.svelte'
    import Sidebar from './lib/components/Sidebar.svelte'
    import Stats from './lib/components/Stats.svelte'
    import Todoist from './lib/components/Todoist.svelte'
    import Weather from './lib/components/Weather.svelte'

    let showSettings = $state(false)
    let showSidebar = $state(false)
    let sidebarTimeout = $state(null)
    let selectedNoteId = $state(null)

    function closeSettings() {
        showSettings = false
    }

    function handleMouseMove(event) {
        if (event.clientX <= 20) {
            clearTimeout(sidebarTimeout)
            showSidebar = true
        } else if (event.clientX > 340) {
            sidebarTimeout = setTimeout(() => {
                showSidebar = false
            }, 300)
        }
    }

    function handleNoteSelect(noteId) {
        selectedNoteId = noteId
    }

    function closeNotePage() {
        selectedNoteId = null
    }
</script>

<svelte:window on:mousemove={handleMouseMove} />

<main>
    <div class="container">
        <div class="top">
            <Clock />
            <Stats />
        </div>
        <div class="widgets">
            <Weather />
            <Todoist />
        </div>
        <Links />
    </div>

    <button
        class="settings-btn"
        onclick={() => (showSettings = true)}
        aria-label="Open settings"
    >
        settings
    </button>

    <Sidebar {showSidebar} onNoteSelect={handleNoteSelect} />
    <Settings {showSettings} {closeSettings} />

    {#if selectedNoteId}
        <NotePage noteId={selectedNoteId} onClose={closeNotePage} />
    {/if}
</main>

<style>
    main {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        justify-content: center;
        align-items: center;
        padding: 2rem 1rem;
    }
    .container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }
    .top,
    .widgets {
        display: flex;
        gap: 1.5rem;
    }
    .settings-btn {
        position: fixed;
        top: 0;
        right: 0;
        padding: 1rem 1.5rem;
        opacity: 0;
        transition: opacity 0.2s ease;
        z-index: 100;
        color: var(--txt-3);
    }
    .settings-btn:hover {
        opacity: 1;
    }
</style>
